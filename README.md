# 多目标粒子群优化 (MOPSO) 博弈系统

## 概述

这是一个基于多目标粒子群优化算法的能源系统博弈优化程序，用于解决EVCA (Electric Vehicle Charging Aggregator) 和 IESO (Independent Electricity System Operator) 之间的博弈问题。

## 主要修复的错误

1. **变量作用域问题**: 修复了原代码中 `swarm_size` 等变量在条件语句外定义导致的作用域错误
2. **粒子初始化错误**: 修复了 `Particle()` 构造函数参数不足的问题
3. **逻辑结构优化**: 重新组织了代码结构，将所有参数初始化移到了合适的位置

## 文件结构

- `mopso.m` - 主要的多目标粒子群优化算法实现
- `Particle.m` - 粒子类定义
- `Repository.m` - 存储库类定义（用于保存Pareto最优解）
- `prob.m` - 目标函数定义
- `main_game.m` - 博弈迭代主程序
- `init_system.m` - 系统初始化脚本

## 使用方法

### 1. 初始化系统
```matlab
% 运行初始化脚本
init_system
```

### 2. 运行博弈优化
```matlab
% 启动博弈迭代过程
main_game
```

### 3. 单独运行MOPSO
```matlab
% 设置EVCA购电比例
W = ones(1,24) * 0.5;  % 24小时，每小时50%购电比例

% 运行MOPSO优化
result = mopso(W);
```

## 系统参数

### 设备参数
- **CHP (Combined Heat and Power)**: 0-800 kW
- **GB (Gas Boiler)**: 0-800 kW  
- **HP (Heat Pump)**: 0-500 kW
- **AC (Absorption Chiller)**: 0-600 kW
- **EC (Electric Chiller)**: 0-800 kW
- **电网购电范围**: -2000 到 5000 kW

### 优化参数
- 粒子群大小: 100
- 最大迭代次数: 100
- 存储库大小: 100
- 网格尺寸: 7×7

## 目标函数

系统优化两个相互冲突的目标：

1. **最大化IESO收益** (最小化负收益)
   - 考虑售电收入、燃料成本、维护成本

2. **最小化碳排放成本**
   - 考虑电网和天然气的碳排放因子

## 约束条件

- 电力平衡约束
- 热平衡约束  
- 冷平衡约束
- 设备容量约束
- 可再生能源出力约束
- 电网交互功率约束

## 博弈过程

1. **IESO优化阶段**: 给定EVCA的购电比例W，IESO通过MOPSO求解最优调度策略
2. **EVCA响应阶段**: 根据IESO的策略，EVCA更新购电比例
3. **迭代收敛**: 重复上述过程直到策略收敛

## 输出结果

- Pareto最优解集
- 收敛过程可视化
- 最终博弈均衡策略
- 各设备最优调度方案

## 可视化

程序会自动生成以下图形：
1. 优化过程中的Pareto前沿演化 (Figure 1)
2. 博弈收敛过程 (Figure 2)  
3. 可再生能源出力曲线 (Figure 10)

## 注意事项

1. 确保所有 `.m` 文件都在MATLAB路径中
2. 运行前先执行 `init_system` 初始化全局变量
3. 如果优化过程中出现收敛问题，可以调整学习率或容差参数
4. 系统使用了简化的示例数据，实际应用时需要替换为真实的负荷和价格数据

## 扩展功能

- 可以修改 `prob.m` 中的负荷曲线和价格数据
- 可以在 `main_game.m` 中调整博弈策略
- 可以修改 `mopso.m` 中的优化参数以提高性能